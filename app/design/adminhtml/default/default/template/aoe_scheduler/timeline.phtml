<?php
/* @var $this Aoe_Scheduler_Block_Adminhtml_Timeline */
$_helper = $this->helper('aoe_scheduler/data');
/* @var $_helper Aoe_Scheduler_Helper_Data */
$_jobs = $this->getAvailableJobs(); /* @var $_jobs array */
?>

<div class="content-header">
    <table cellspacing="0">
        <tr>
            <td style="<?php echo $this->getHeaderWidth() ?>"><?php echo $this->getHeaderHtml() ?></td>
            <td class="form-buttons"><?php echo $this->getButtonsHtml() ?></td>
        </tr>
    </table>
</div>

<div id="maincontainer">

    <?php if (count($_jobs) > 0): ?>

        <div id="contentwrapper">
            <div id="contentcolumn">
                <div class="timeline-box">
                    <div class="timeline-panel" style="width: <?php echo $this->getTimelinePanelWidth(); ?>px;">

                        <div id="now" style="left: <?php echo $this->getNowline(); ?>px"><div class="arrow"></div></div>

                        <div class="row hours">
                            <div class="timeline">
                                <?php for ($i = $this->getStarttime(); $i < $this->getEndtime(); $i += 60 * 60): ?>
                                    <div class="hour"><span><?php echo $_helper->decorateTime($i, false, 'Y-m-d H:i'); ?></span></div>
                                <?php endfor; ?>
                            </div>
                        </div>

                        <?php foreach ($_jobs as $_jobCode => $_schedules): /* @var $_jobCode string */ /* @var $_schedules array */ ?>
                            <div class="row">
                                <div class="timeline timeline_<?php echo $_jobCode; ?>">
                                    <?php foreach ($_schedules as $_schedule): /* @var $_schedule Aoe_Scheduler_Model_Schedule */ ?>
                                        <?php echo $this->getGanttDivAttributes($_schedule); ?>
                                        <?php echo $this->getLayout()->createBlock('aoe_scheduler/adminhtml_timelineDetail')->setSchedule($_schedule)->toHtml(); ?>
                                    <?php endforeach; ?>
                                </div>
                            </div>
                        <?php endforeach; ?>

                    </div>
                </div>
            </div>
            <!-- id="contentcolumn" -->
        </div><!-- id="contentwrapper" -->

        <div id="leftcolumn">

            <div class="row hours">
                <div class="caption"><?php echo $_helper->decorateTime($this->getStarttime(), true, 'Y-m-d H:i'); ?>
                    - <?php echo $_helper->decorateTime($this->getEndtime(), true, 'Y-m-d H:i'); ?></div>
            </div>

            <?php foreach ($_jobs as $_jobCode => $_schedules): /* @var $_jobCode string */ /* @var $_schedules array */ ?>
                <div class="row">
                    <div class="timeline-row-info">
                        <?php
                        $_schedule = reset($_schedules);
                        $_name = $_schedule->getJob()->getName(); 
                        $_groups = $_schedule->getJob()->getGroups();
                            if ($_name !== $_jobCode):
                                echo $this->__('<b>Name:</b> ') .  $_name . "<br>";
                            endif;
                            echo $this->__('<b>Job Code:</b> ') .  $_jobCode . "<br>";
                            if ($_groups !== $_jobCode):
                                echo $this->__('<b>Crongroups:</b> ') . $_groups;
                            endif;
                        ?>
                    </div>
                </div>
            <?php endforeach; ?>

        </div><!-- id="leftcolumn" -->

    <?php else: ?>
        <?php echo $this->__('No tasks found.'); ?>
    <?php endif; ?>

</div><!-- id="maincontainer" -->
